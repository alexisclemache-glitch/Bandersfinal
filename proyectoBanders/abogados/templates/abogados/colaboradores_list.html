{% extends "vertical.html" %}
{% load static %}

{% block title %} Directorio Exclusivo | Banders {% endblock %}

{% block page_content %}
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>

<div class="container-fluid py-5" style="font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; min-height: 100vh;">

    {# HEADER #}
    <div class="row mb-5">
        <div class="col-md-8">
            <span class="badge bg-soft-primary text-primary px-3 py-2 rounded-pill fw-bold mb-2 text-uppercase ls-1" style="font-size: 0.65rem;">Staff Profesional</span>
            <h2 class="fw-800 text-dark mb-1" style="letter-spacing: -1px;">Directorio de Colaboradores</h2>
            <p class="text-muted fw-500">Gestión de especialistas y activos legales de la firma.</p>
        </div>
        {% if user.is_superuser %}
        <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
            <div class="admin-status px-3 py-2 rounded-4 border d-inline-flex align-items-center bg-white shadow-sm">
                <span class="status-dot pulse bg-danger me-2"></span>
                <span class="small fw-700 text-dark">Panel de Control Admin</span>
            </div>
        </div>
        {% endif %}
    </div>

    {# GRID DE COLABORADORES #}
    <div class="row g-4">
        {% for colab in colaboradores %}
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="card-premium h-100">

                {# ACCIONES DE ADMIN (ACTIVACIÓN Y ELIMINACIÓN) #}
                {% if user.is_superuser %}
                <div class="admin-actions-container d-flex gap-2">
                    <a href="{% url 'abogados:activar_colaborador' colab.pk %}"
                       class="btn-check-premium {% if colab.user.is_active %}is-active{% else %}is-inactive{% endif %}"
                       title="{% if colab.user.is_active %}Desactivar Acceso{% else %}Activar Acceso{% endif %}">
                        {% if colab.user.is_active %}
                            <iconify-icon icon="solar:shield-check-bold-duotone"></iconify-icon>
                        {% else %}
                            <iconify-icon icon="solar:shield-warning-bold-duotone"></iconify-icon>
                        {% endif %}
                    </a>

                    <button type="button" class="btn-trash-premium" data-bs-toggle="modal" data-bs-target="#delModal{{ colab.pk }}">
                        <iconify-icon icon="solar:trash-bin-minimalistic-bold-duotone"></iconify-icon>
                    </button>
                </div>
                {% endif %}

                <div class="card-content text-center">
                    <div class="avatar-box mb-4">
                        <div class="avatar-ring"></div>
                        <img src="{% if colab.foto %}{{ colab.foto.url }}{% else %}{% static 'images/users/avatar-1.jpg' %}{% endif %}" class="profile-img">
                        <div class="online-badge {% if not colab.user.is_active %}bg-danger shadow-danger{% endif %}"></div>
                    </div>

                    <h5 class="fw-800 text-dark mb-1">{{ colab.user.get_full_name|default:colab.user.username }}</h5>
                    <p class="text-primary-pro fw-700 small mb-3 text-uppercase ls-1">{{ colab.especialidad|default:"Abogado Jurídico" }}</p>

                    <div class="stats-mini d-flex justify-content-center gap-3 mb-4">
                        <div class="stat-item text-center">
                            <div class="d-flex align-items-center justify-content-center gap-1 mb-1">
                                <iconify-icon icon="solar:scale-bold-duotone" class="text-primary-pro" style="font-size: 1.2rem;"></iconify-icon>
                                <span class="fw-800 text-dark">{{ colab.expedientes.count|default:"0" }}</span>
                            </div>
                            <span class="x-small text-muted fw-600 text-uppercase">Justicia</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-item text-center">
                            <div class="d-flex align-items-center justify-content-center gap-1 mb-1">
                                <iconify-icon icon="solar:star-bold-duotone" class="text-warning" style="font-size: 1.2rem;"></iconify-icon>
                                <span class="fw-800 text-dark">4.9</span>
                            </div>
                            <span class="x-small text-muted fw-600 text-uppercase">Rating</span>
                        </div>
                    </div>

                    <a href="{% url 'abogados:perfil_detail' colab.pk %}" class="btn-premium-action w-100">
                        <span>Perfil Ejecutivo</span>
                        <iconify-icon icon="solar:arrow-right-up-bold-duotone" class="ms-2"></iconify-icon>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{# MODALES DE ELIMINACIÓN #}
{% if user.is_superuser %}
    {% for colab in colaboradores %}
    <div class="modal fade" id="delModal{{ colab.pk }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0 shadow-lg rounded-5 overflow-hidden">
                <div class="modal-body p-4 text-center">
                    <div class="icon-shape bg-soft-danger text-danger mb-3 mx-auto">
                        <iconify-icon icon="solar:danger-bold-duotone" width="35"></iconify-icon>
                    </div>
                    <h5 class="fw-800 text-dark">¿Confirmar Baja?</h5>
                    <p class="text-muted small mb-4">Se revocará el acceso de <b>{{ colab.user.username }}</b> de forma definitiva.</p>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-light-pro w-100" data-bs-dismiss="modal">Cancelar</button>
                        <a href="{% url 'abogados:colaborador_delete' colab.pk %}" class="btn btn-danger-pro w-100">Eliminar</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% endif %}
{% endblock page_content %}

{% block extra_css %}
<style>
    /* VARIABLES Y GENERALES */
    .fw-800 { font-weight: 800; }
    .ls-1 { letter-spacing: 1px; }
    .x-small { font-size: 0.65rem; }
    .text-primary-pro { color: #405189; }
    .bg-soft-danger { background: rgba(239, 68, 68, 0.1); }

    /* CARD PREMIUM */
    .card-premium {
        background: #fff;
        border-radius: 28px;
        padding: 35px 25px;
        border: 1px solid #eef2f7;
        transition: all 0.3s ease-in-out;
        position: relative;
    }
    .card-premium:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(64, 81, 137, 0.1);
    }

    /* CONTENEDOR DE ACCIONES ADMIN */
    .admin-actions-container {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 5;
        opacity: 0;
        transition: opacity 0.2s ease;
    }
    .card-premium:hover .admin-actions-container {
        opacity: 1;
    }

    /* BOTÓN TRASH */
    .btn-trash-premium {
        width: 35px; height: 35px;
        border-radius: 10px;
        background: #fff;
        color: #ef4444;
        border: 1px solid #fee2e2;
        display: flex; align-items: center; justify-content: center;
        transition: 0.2s;
        cursor: pointer;
    }
    .btn-trash-premium:hover { background: #ef4444; color: #fff; }

    /* BOTÓN CHECK ACTIVACIÓN */
    .btn-check-premium {
        width: 35px; height: 35px;
        border-radius: 10px;
        display: flex; align-items: center; justify-content: center;
        transition: 0.2s;
        cursor: pointer;
        border: 1px solid transparent;
        text-decoration: none;
        font-size: 1.1rem;
    }
    .btn-check-premium.is-active {
        background: #fff;
        color: #10b981;
        border: 1px solid #d1fae5;
    }
    .btn-check-premium.is-active:hover { background: #10b981; color: #fff; }

    .btn-check-premium.is-inactive {
        background: #fff;
        color: #f59e0b;
        border: 1px solid #fef3c7;
    }
    .btn-check-premium.is-inactive:hover { background: #f59e0b; color: #fff; }

    /* AVATAR Y BADGES */
    .avatar-box { position: relative; display: inline-block; width: 100px; height: 100px; }
    .profile-img { width: 100%; height: 100%; object-fit: cover; border-radius: 30px; position: relative; z-index: 2; }
    .avatar-ring { position: absolute; top: -6px; left: -6px; right: -6px; bottom: -6px; border: 2px solid #f1f5f9; border-radius: 35px; transition: 0.4s; }
    .card-premium:hover .avatar-ring { border-color: #405189; transform: rotate(15deg); }

    .online-badge {
        position: absolute; bottom: 5px; right: 5px;
        width: 18px; height: 18px;
        background: #10b981;
        border: 3px solid #fff;
        border-radius: 50%;
        z-index: 3;
    }
    .bg-danger { background: #ef4444 !important; }
    .shadow-danger { box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2); }

    /* STATS Y BOTONES */
    .stat-divider { width: 1px; height: 30px; background: #f1f5f9; }
    .btn-premium-action { background: #111827; color: #fff; padding: 12px; border-radius: 15px; font-weight: 700; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; text-decoration: none; transition: 0.3s; }
    .btn-premium-action:hover { background: #405189; }
    .btn-light-pro { background: #f3f4f6; color: #374151; border-radius: 12px; border: none; font-weight: 700; padding: 10px; }
    .btn-danger-pro { background: #ef4444; color: #fff; border-radius: 12px; border: none; font-weight: 700; padding: 10px; text-decoration: none; text-align: center; }

    /* MODALES */
    .modal { background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(4px); }
    .icon-shape { width: 60px; height: 60px; border-radius: 18px; display: flex; align-items: center; justify-content: center; }

    /* ANIMACIONES */
    .pulse { animation: pulse-animation 2s infinite; }
    @keyframes pulse-animation {
        0% { box-shadow: 0 0 0 0px rgba(239, 68, 68, 0.4); }
        100% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
    }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; }
</style>
{% endblock extra_css %}